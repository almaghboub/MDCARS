import { createContext, useContext, useState, useEffect, useCallback } from "react";

type Language = "en" | "ar";

const translations = {
  en: {
    // Common
    save: "Save",
    cancel: "Cancel",
    delete: "Delete",
    edit: "Edit",
    add: "Add",
    search: "Search",
    loading: "Loading...",
    close: "Close",
    actions: "Actions",
    status: "Status",
    active: "Active",
    inactive: "Inactive",
    error: "Error",
    update: "Update",
    name: "Name",
    phone: "Phone",
    email: "Email",
    notes: "Notes",
    description: "Description",
    date: "Date",
    amount: "Amount",
    total: "Total",
    price: "Price",
    quantity: "Qty",
    type: "Type",
    category: "Category",
    all: "All",
    noData: "No data found",
    confirm: "Confirm",
    yes: "Yes",
    no: "No",

    // Auth
    welcomeBack: "Welcome Back",
    carAccessoriesSales: "Car Accessories Sales & Inventory",
    username: "Username",
    password: "Password",
    signIn: "Sign In",
    signingIn: "Signing in...",
    loginSuccessful: "Login Successful",
    welcomeMdCars: "Welcome to MD CARS",
    loginFailed: "Login Failed",
    invalidCredentials: "Invalid username or password",
    defaultCredentials: "Default: admin / admin123",
    logout: "Logout",

    // Navigation
    dashboard: "Dashboard",
    posSales: "POS / Sales",
    products: "Products",
    inventory: "Inventory",
    customers: "Customers",
    finance: "Finance",
    reports: "Reports",
    settings: "Settings",

    // Dashboard
    welcomeSystem: "Welcome to MD CARS Management System",
    todaysSales: "Today's Sales",
    todaysRevenue: "Today's Revenue",
    totalProducts: "Total Products",
    totalCustomers: "Total Customers",
    lowStockItems: "Low Stock Items",
    cashboxBalance: "Cashbox Balance",
    lydBalance: "LYD Balance",
    usdBalance: "USD Balance",
    lowStockAlert: "Low Stock Alert",
    allWellStocked: "All products are well stocked",
    bestSellingProducts: "Best Selling Products",
    noSalesDataYet: "No sales data yet",
    sold: "sold",
    left: "left",
    viewAll: "View All",
    newSale: "New Sale",

    // POS
    pointOfSale: "Point of Sale",
    searchByNameSkuBarcode: "Search by name, SKU, or barcode...",
    cart: "Cart",
    items: "items",
    cartIsEmpty: "Cart is empty",
    subtotal: "Subtotal",
    discount: "Discount",
    checkout: "Checkout",
    completeSale: "Complete Sale",
    currency: "Currency",
    amountPaid: "Amount Paid",
    amountDue: "Amount Due",
    addedToCustomerBalance: "This will be added to customer's balance",
    change: "Change",
    processing: "Processing...",
    saleCompleted: "Sale completed!",
    outOfStock: "Out of stock",
    notEnoughStock: "Not enough stock",
    selectCustomer: "Select Customer",
    selectOrCreateCustomer: "Select or Create Customer",
    searchCustomers: "Search customers...",
    createNewCustomer: "Create New Customer",
    createCustomer: "Create Customer",
    continueAsWalkin: "Continue as Walk-in",
    walkin: "Walk-in",
    customerCreated: "Customer created",
    invoiceReceipt: "Invoice / Receipt",
    invoiceNumber: "Invoice #",
    soldBy: "Sold by",
    customer: "Customer",
    item: "Item",
    paid: "Paid",
    thankYou: "Thank you for your purchase!",
    printInvoice: "Print Invoice",

    // Products
    manageProductCatalog: "Manage your product catalog",
    addCategory: "Add Category",
    addProduct: "Add Product",
    editProduct: "Edit Product",
    productName: "Product Name",
    similarProductsFound: "Similar products found — click to edit:",
    sku: "SKU",
    barcode: "Barcode (Optional)",
    costPrice: "Cost Price (LYD)",
    sellingPrice: "Selling Price (LYD)",
    initialStock: "Initial Stock",
    lowStockAlertThreshold: "Low Stock Alert",
    productCatalog: "Product Catalog",
    searchProducts: "Search products...",
    noProductsFound: "No products found. Add your first product!",
    cost: "Cost",
    stock: "Stock",
    low: "Low",
    categoryName: "Category name is required",
    productCreated: "Product created successfully",
    productUpdated: "Product updated successfully",
    productDeleted: "Product deleted successfully",
    categoryCreated: "Category created successfully",
    saving: "Saving...",
    updateProduct: "Update Product",
    saveCategory: "Save Category",

    // Inventory
    inventoryManagement: "Inventory Management",
    trackStockMovements: "Track stock levels and movements",
    stockIn: "Stock In",
    stockOut: "Stock Out",
    adjustment: "Adjustment",
    addStockMovement: "Add Stock Movement",
    selectProduct: "Select Product",
    movementType: "Movement Type",
    reason: "Reason",
    previousStock: "Previous Stock",
    newStock: "New Stock",
    stockMovements: "Stock Movements",
    product: "Product",
    createdBy: "Created By",

    // Customers
    customerDatabase: "Customer Database",
    manageCustomers: "Manage your customer database",
    addCustomer: "Add Customer",
    editCustomer: "Edit Customer",
    address: "Address",
    balanceOwed: "Balance Owed",
    totalPurchases: "Total Purchases",
    purchaseHistory: "Purchase History",
    noCustomersFound: "No customers found",
    customerSaved: "Customer saved successfully",
    customerDeleted: "Customer deleted successfully",

    // Finance
    financialManagement: "Financial Management",
    manageFinances: "Manage cashbox, expenses, and revenues",
    cashbox: "Cashbox",
    expenses: "Expenses",
    revenues: "Revenues",
    transactions: "Transactions",
    addTransaction: "Add Transaction",
    addExpense: "Add Expense",
    addRevenue: "Add Revenue",
    deposit: "Deposit",
    withdrawal: "Withdrawal",
    sale: "Sale",
    expense: "Expense",
    revenue: "Revenue",
    transactionType: "Transaction Type",
    amountUSD: "Amount (USD)",
    amountLYD: "Amount (LYD)",
    exchangeRate: "Exchange Rate",
    expenseCategory: "Expense Category",
    rent: "Rent",
    utilities: "Utilities",
    salaries: "Salaries",
    supplies: "Supplies",
    maintenance: "Maintenance",
    marketing: "Marketing",
    other: "Other",
    noTransactions: "No transactions yet",
    noExpenses: "No expenses recorded",
    noRevenues: "No revenues recorded",

    // Reports
    reportsAnalytics: "Reports & Analytics",
    viewReports: "View sales reports and analytics",
    salesHistory: "Sales History",
    bestSellers: "Best Sellers",
    dailySummary: "Daily Summary",
    filterByDate: "Filter by date...",
    exportCSV: "Export CSV",
    saleNumber: "Sale #",
    profit: "Profit",
    payment: "Payment",
    totalSales: "Total Sales",
    totalRevenue: "Total Revenue",
    totalProfit: "Total Profit",
    avgOrderValue: "Avg Order Value",
    noSalesFound: "No sales found for this period",
    totalSold: "Total Sold",
    unitsSold: "units sold",

    // Settings
    manageSettings: "Manage users and system settings",
    userManagement: "User Management",
    security: "Security",
    systemInfo: "System Info",
    users: "Users",
    addUser: "Add User",
    editUser: "Edit User",
    firstName: "First Name",
    lastName: "Last Name",
    role: "Role",
    ownerFullAccess: "Owner (Full Access)",
    cashierSalesOnly: "Worker / Cashier (Sales Only - No Financial Access)",
    stockManagerInventory: "Stock Manager (Inventory Only)",
    saveUser: "Save User",
    updateUser: "Update User",
    userCreated: "User created successfully",
    userUpdated: "User updated successfully",
    userDeleted: "User deleted successfully",
    noUsersFound: "No users found",
    changePassword: "Change Password",
    updatePassword: "Update your account password",
    currentPassword: "Current Password",
    newPassword: "New Password",
    confirmPassword: "Confirm New Password",
    passwordChanged: "Password changed successfully",
    changing: "Changing...",
    rolePermissions: "Role Permissions",
    overviewAccessLevels: "Overview of access levels",
    ownerDesc: "Full access to all features including reports, finances, settings, and user management.",
    cashierDesc: "Can create invoices, sell products, and manage customers. Cannot see cost prices, financial reports, profits, or system settings.",
    stockManagerDesc: "Access to inventory management and products. Can add/remove stock and manage product catalog.",
    owner: "Owner",
    cashier: "Cashier (Worker)",
    stockManager: "Stock Manager",
    application: "Application",
    version: "Version",
    currencySupport: "Currency Support",
    database: "Database",
    systemInformation: "System Information",
    newPasswordLeaveBlank: "New Password (leave blank to keep current)",
    language: "Language",
    english: "English",
    arabic: "Arabic",
    stockUpdatedSuccessfully: "Stock updated successfully",
    expenseRecordedSuccessfully: "Expense recorded successfully",
    revenueRecordedSuccessfully: "Revenue recorded successfully",
    transactionRecordedSuccessfully: "Transaction recorded successfully",
    expenseDeleted: "Expense deleted",
    revenueDeleted: "Revenue deleted",
    paidTo: "Paid To (Optional)",
    source: "Source",
    net: "Net (Rev - Exp)",
    cashboxTransactions: "Cashbox Transactions",
    addCashboxTransaction: "Add Cashbox Transaction",
    number: "Number",
    today: "Today",
    lastSevenDays: "Last 7 Days",
    thisMonth: "This Month",
    thisYear: "This Year",
    salesPerformance: "Sales performance and business insights",
    noSalesInPeriod: "No sales in this period",
    dailySalesData: "No daily data available",
    restock: "Restock",
    stockLevels: "Stock Levels",
    currentStock: "Current Stock",
    lowThreshold: "Low Threshold",
    inStock: "In Stock",
    outOfStockLabel: "Out of Stock",
    lowStock: "Low Stock",
    recentStockMovements: "Recent Stock Movements",
    noStockMovements: "No stock movements recorded yet",
    newStockLevel: "New Stock Level",
    costPerUnit: "Cost per Unit (LYD)",
    enterReason: "Enter reason for stock change",
    updating: "Updating...",
    updateStock: "Update Stock",
    recordPayment: "Record Payment",
    paymentRecorded: "Payment recorded successfully",
    currentBalance: "Current Balance",
    paymentAmountLYD: "Payment Amount (LYD)",
    enterAmount: "Enter amount",
    customerDetails: "Customer Details",
    noPurchasesYet: "No purchases yet",

    // Sales Income & Invoice & Returns
    invoiceHistory: "Invoice History",
    invoices: "Invoices",
    allInvoices: "All Invoices",
    searchInvoices: "Search by invoice #, customer...",
    allStatuses: "All Statuses",
    noInvoicesFound: "No invoices found",
    showing: "Showing",
    invoicesOf: "of",
    salesIncome: "Sales Income",
    invoiceDetails: "Invoice Details",
    viewInvoice: "View Invoice",
    returnSale: "Return",
    returnConfirmTitle: "Return This Sale?",
    returnConfirmMessage: "This will return all items to stock and refund the payment from the cashbox. This action cannot be undone.",
    saleReturned: "Sale returned successfully",
    returned: "Returned",
    cancelled: "Cancelled",
    completed: "Completed",
    pending: "Pending",
    refund: "Refund",
    noSalesIncome: "No sales income yet",
    unitPrice: "Unit Price",
    totalPrice: "Total Price",
    paymentMethod: "Payment Method",
    cash: "Cash",
    partial: "Partial",
    saleDetails: "Sale Details",
    itemsList: "Items",
    returnProcessing: "Processing return...",

    // Partners / Store Capital
    storeCapital: "Store Capital",
    partners: "Partners",
    partner: "Partner",
    addPartner: "Add Partner",
    editPartner: "Edit Partner",
    partnerAdded: "Partner added successfully",
    partnerUpdated: "Partner updated successfully",
    ownershipPercentage: "Ownership",
    ownershipWarning: "Total ownership percentage does not equal 100%",
    totalInvested: "Total Invested",
    totalWithdrawn: "Total Withdrawn",
    profitDistributed: "Profit Distributed",
    netBalance: "Net Balance",
    recordTransaction: "Record Transaction",
    transactionRecorded: "Transaction recorded successfully",
    selectPartner: "Select partner",
    investment: "Investment",
    profitDistribution: "Profit Distribution",
    partnerTransactions: "Partner Transactions",
    noPartnersYet: "No partners added yet",
    addPartnersToStart: "Add your business partners to start tracking investments and profits",
    noTransactionsYet: "No transactions recorded yet",
  },
  ar: {
    // Common
    save: "حفظ",
    cancel: "إلغاء",
    delete: "حذف",
    edit: "تعديل",
    add: "إضافة",
    search: "بحث",
    loading: "جاري التحميل...",
    close: "إغلاق",
    actions: "إجراءات",
    status: "الحالة",
    active: "نشط",
    inactive: "غير نشط",
    error: "خطأ",
    update: "تحديث",
    name: "الاسم",
    phone: "الهاتف",
    email: "البريد الإلكتروني",
    notes: "ملاحظات",
    description: "الوصف",
    date: "التاريخ",
    amount: "المبلغ",
    total: "الإجمالي",
    price: "السعر",
    quantity: "الكمية",
    type: "النوع",
    category: "الفئة",
    all: "الكل",
    noData: "لا توجد بيانات",
    confirm: "تأكيد",
    yes: "نعم",
    no: "لا",

    // Auth
    welcomeBack: "مرحباً بعودتك",
    carAccessoriesSales: "نظام مبيعات ومخزون إكسسوارات السيارات",
    username: "اسم المستخدم",
    password: "كلمة المرور",
    signIn: "تسجيل الدخول",
    signingIn: "جاري تسجيل الدخول...",
    loginSuccessful: "تم تسجيل الدخول بنجاح",
    welcomeMdCars: "مرحباً بك في MD CARS",
    loginFailed: "فشل تسجيل الدخول",
    invalidCredentials: "اسم المستخدم أو كلمة المرور غير صحيحة",
    defaultCredentials: "الافتراضي: admin / admin123",
    logout: "تسجيل الخروج",

    // Navigation
    dashboard: "لوحة التحكم",
    posSales: "نقطة البيع",
    products: "المنتجات",
    inventory: "المخزون",
    customers: "العملاء",
    finance: "المالية",
    reports: "التقارير",
    settings: "الإعدادات",

    // Dashboard
    welcomeSystem: "مرحباً بك في نظام إدارة MD CARS",
    todaysSales: "مبيعات اليوم",
    todaysRevenue: "إيرادات اليوم",
    totalProducts: "إجمالي المنتجات",
    totalCustomers: "إجمالي العملاء",
    lowStockItems: "منتجات منخفضة المخزون",
    cashboxBalance: "رصيد الصندوق",
    lydBalance: "رصيد الدينار الليبي",
    usdBalance: "رصيد الدولار",
    lowStockAlert: "تنبيه المخزون المنخفض",
    allWellStocked: "جميع المنتجات متوفرة بكميات كافية",
    bestSellingProducts: "المنتجات الأكثر مبيعاً",
    noSalesDataYet: "لا توجد بيانات مبيعات بعد",
    sold: "مباع",
    left: "متبقي",
    viewAll: "عرض الكل",
    newSale: "بيع جديد",

    // POS
    pointOfSale: "نقطة البيع",
    searchByNameSkuBarcode: "البحث بالاسم أو الرمز أو الباركود...",
    cart: "السلة",
    items: "عناصر",
    cartIsEmpty: "السلة فارغة",
    subtotal: "المجموع الفرعي",
    discount: "الخصم",
    checkout: "إتمام البيع",
    completeSale: "إتمام عملية البيع",
    currency: "العملة",
    amountPaid: "المبلغ المدفوع",
    amountDue: "المبلغ المتبقي",
    addedToCustomerBalance: "سيتم إضافته إلى رصيد العميل",
    change: "الباقي",
    processing: "جاري المعالجة...",
    saleCompleted: "تمت عملية البيع بنجاح!",
    outOfStock: "غير متوفر",
    notEnoughStock: "الكمية غير كافية",
    selectCustomer: "اختيار عميل",
    selectOrCreateCustomer: "اختيار أو إنشاء عميل",
    searchCustomers: "البحث عن عملاء...",
    createNewCustomer: "إنشاء عميل جديد",
    createCustomer: "إنشاء عميل",
    continueAsWalkin: "متابعة بدون عميل",
    walkin: "عميل عابر",
    customerCreated: "تم إنشاء العميل",
    invoiceReceipt: "الفاتورة / الإيصال",
    invoiceNumber: "رقم الفاتورة",
    soldBy: "البائع",
    customer: "العميل",
    item: "المنتج",
    paid: "المدفوع",
    thankYou: "شكراً لتسوقكم!",
    printInvoice: "طباعة الفاتورة",

    // Products
    manageProductCatalog: "إدارة كتالوج المنتجات",
    addCategory: "إضافة فئة",
    addProduct: "إضافة منتج",
    editProduct: "تعديل منتج",
    productName: "اسم المنتج",
    similarProductsFound: "تم العثور على منتجات مشابهة — انقر للتعديل:",
    sku: "رمز المنتج",
    barcode: "الباركود (اختياري)",
    costPrice: "سعر التكلفة (د.ل)",
    sellingPrice: "سعر البيع (د.ل)",
    initialStock: "المخزون الأولي",
    lowStockAlertThreshold: "حد التنبيه للمخزون",
    productCatalog: "كتالوج المنتجات",
    searchProducts: "البحث عن منتجات...",
    noProductsFound: "لا توجد منتجات. أضف منتجك الأول!",
    cost: "التكلفة",
    stock: "المخزون",
    low: "منخفض",
    categoryName: "اسم الفئة مطلوب",
    productCreated: "تم إنشاء المنتج بنجاح",
    productUpdated: "تم تحديث المنتج بنجاح",
    productDeleted: "تم حذف المنتج بنجاح",
    categoryCreated: "تم إنشاء الفئة بنجاح",
    saving: "جاري الحفظ...",
    updateProduct: "تحديث المنتج",
    saveCategory: "حفظ الفئة",

    // Inventory
    inventoryManagement: "إدارة المخزون",
    trackStockMovements: "تتبع مستويات وحركات المخزون",
    stockIn: "إدخال مخزون",
    stockOut: "إخراج مخزون",
    adjustment: "تعديل",
    addStockMovement: "إضافة حركة مخزون",
    selectProduct: "اختيار منتج",
    movementType: "نوع الحركة",
    reason: "السبب",
    previousStock: "المخزون السابق",
    newStock: "المخزون الجديد",
    stockMovements: "حركات المخزون",
    product: "المنتج",
    createdBy: "بواسطة",

    // Customers
    customerDatabase: "قاعدة بيانات العملاء",
    manageCustomers: "إدارة قاعدة بيانات العملاء",
    addCustomer: "إضافة عميل",
    editCustomer: "تعديل عميل",
    address: "العنوان",
    balanceOwed: "الرصيد المستحق",
    totalPurchases: "إجمالي المشتريات",
    purchaseHistory: "سجل المشتريات",
    noCustomersFound: "لا يوجد عملاء",
    customerSaved: "تم حفظ العميل بنجاح",
    customerDeleted: "تم حذف العميل بنجاح",

    // Finance
    financialManagement: "الإدارة المالية",
    manageFinances: "إدارة الصندوق والمصروفات والإيرادات",
    cashbox: "الصندوق",
    expenses: "المصروفات",
    revenues: "الإيرادات",
    transactions: "المعاملات",
    addTransaction: "إضافة معاملة",
    addExpense: "إضافة مصروف",
    addRevenue: "إضافة إيراد",
    deposit: "إيداع",
    withdrawal: "سحب",
    sale: "بيع",
    expense: "مصروف",
    revenue: "إيراد",
    transactionType: "نوع المعاملة",
    amountUSD: "المبلغ (دولار)",
    amountLYD: "المبلغ (د.ل)",
    exchangeRate: "سعر الصرف",
    expenseCategory: "فئة المصروف",
    rent: "إيجار",
    utilities: "مرافق",
    salaries: "رواتب",
    supplies: "مستلزمات",
    maintenance: "صيانة",
    marketing: "تسويق",
    other: "أخرى",
    noTransactions: "لا توجد معاملات بعد",
    noExpenses: "لا توجد مصروفات مسجلة",
    noRevenues: "لا توجد إيرادات مسجلة",

    // Reports
    reportsAnalytics: "التقارير والتحليلات",
    viewReports: "عرض تقارير المبيعات والتحليلات",
    salesHistory: "سجل المبيعات",
    bestSellers: "الأكثر مبيعاً",
    dailySummary: "الملخص اليومي",
    filterByDate: "تصفية حسب التاريخ...",
    exportCSV: "تصدير CSV",
    saleNumber: "رقم البيع",
    profit: "الربح",
    payment: "الدفع",
    totalSales: "إجمالي المبيعات",
    totalRevenue: "إجمالي الإيرادات",
    totalProfit: "إجمالي الأرباح",
    avgOrderValue: "متوسط قيمة الطلب",
    noSalesFound: "لا توجد مبيعات لهذه الفترة",
    totalSold: "إجمالي المباع",
    unitsSold: "وحدة مباعة",

    // Settings
    manageSettings: "إدارة المستخدمين وإعدادات النظام",
    userManagement: "إدارة المستخدمين",
    security: "الأمان",
    systemInfo: "معلومات النظام",
    users: "المستخدمون",
    addUser: "إضافة مستخدم",
    editUser: "تعديل مستخدم",
    firstName: "الاسم الأول",
    lastName: "اسم العائلة",
    role: "الدور",
    ownerFullAccess: "مالك (صلاحيات كاملة)",
    cashierSalesOnly: "عامل / كاشير (مبيعات فقط - بدون صلاحيات مالية)",
    stockManagerInventory: "مدير مخزون (مخزون فقط)",
    saveUser: "حفظ المستخدم",
    updateUser: "تحديث المستخدم",
    userCreated: "تم إنشاء المستخدم بنجاح",
    userUpdated: "تم تحديث المستخدم بنجاح",
    userDeleted: "تم حذف المستخدم بنجاح",
    noUsersFound: "لا يوجد مستخدمون",
    changePassword: "تغيير كلمة المرور",
    updatePassword: "تحديث كلمة مرور حسابك",
    currentPassword: "كلمة المرور الحالية",
    newPassword: "كلمة المرور الجديدة",
    confirmPassword: "تأكيد كلمة المرور الجديدة",
    passwordChanged: "تم تغيير كلمة المرور بنجاح",
    changing: "جاري التغيير...",
    rolePermissions: "صلاحيات الأدوار",
    overviewAccessLevels: "نظرة عامة على مستويات الوصول",
    ownerDesc: "صلاحيات كاملة لجميع الميزات بما في ذلك التقارير والمالية والإعدادات وإدارة المستخدمين.",
    cashierDesc: "يمكنه إنشاء فواتير وبيع المنتجات وإدارة العملاء. لا يمكنه رؤية أسعار التكلفة أو التقارير المالية أو الأرباح أو إعدادات النظام.",
    stockManagerDesc: "الوصول إلى إدارة المخزون والمنتجات. يمكنه إضافة/إزالة المخزون وإدارة كتالوج المنتجات.",
    owner: "المالك",
    cashier: "كاشير (عامل)",
    stockManager: "مدير المخزون",
    application: "التطبيق",
    version: "الإصدار",
    currencySupport: "العملات المدعومة",
    database: "قاعدة البيانات",
    systemInformation: "معلومات النظام",
    newPasswordLeaveBlank: "كلمة مرور جديدة (اتركها فارغة للإبقاء على الحالية)",
    language: "اللغة",
    english: "English",
    arabic: "العربية",
    stockUpdatedSuccessfully: "تم تحديث المخزون بنجاح",
    expenseRecordedSuccessfully: "تم تسجيل المصروف بنجاح",
    revenueRecordedSuccessfully: "تم تسجيل الإيراد بنجاح",
    transactionRecordedSuccessfully: "تم تسجيل المعاملة بنجاح",
    expenseDeleted: "تم حذف المصروف",
    revenueDeleted: "تم حذف الإيراد",
    paidTo: "مدفوع إلى (اختياري)",
    source: "المصدر",
    net: "الصافي (إيرادات - مصروفات)",
    cashboxTransactions: "معاملات الصندوق",
    addCashboxTransaction: "إضافة معاملة للصندوق",
    number: "الرقم",
    today: "اليوم",
    lastSevenDays: "آخر 7 أيام",
    thisMonth: "هذا الشهر",
    thisYear: "هذا العام",
    salesPerformance: "أداء المبيعات ورؤى الأعمال",
    noSalesInPeriod: "لا توجد مبيعات في هذه الفترة",
    dailySalesData: "لا توجد بيانات يومية متاحة",
    restock: "إعادة تعبئة",
    stockLevels: "مستويات المخزون",
    currentStock: "المخزون الحالي",
    lowThreshold: "حد التنبيه",
    inStock: "متوفر",
    outOfStockLabel: "نفد المخزون",
    lowStock: "مخزون منخفض",
    recentStockMovements: "حركات المخزون الأخيرة",
    noStockMovements: "لم يتم تسجيل حركات مخزون بعد",
    newStockLevel: "مستوى المخزون الجديد",
    costPerUnit: "تكلفة الوحدة (د.ل)",
    enterReason: "أدخل سبب تغيير المخزون",
    updating: "جاري التحديث...",
    updateStock: "تحديث المخزون",
    recordPayment: "تسجيل دفعة",
    paymentRecorded: "تم تسجيل الدفعة بنجاح",
    currentBalance: "الرصيد الحالي",
    paymentAmountLYD: "مبلغ الدفعة (د.ل)",
    enterAmount: "أدخل المبلغ",
    customerDetails: "تفاصيل العميل",
    noPurchasesYet: "لا توجد مشتريات بعد",

    // Sales Income & Invoice & Returns
    invoiceHistory: "سجل الفواتير",
    invoices: "الفواتير",
    allInvoices: "جميع الفواتير",
    searchInvoices: "بحث برقم الفاتورة أو العميل...",
    allStatuses: "جميع الحالات",
    noInvoicesFound: "لم يتم العثور على فواتير",
    showing: "عرض",
    invoicesOf: "من",
    salesIncome: "دخل المبيعات",
    invoiceDetails: "تفاصيل الفاتورة",
    viewInvoice: "عرض الفاتورة",
    returnSale: "إرجاع",
    returnConfirmTitle: "إرجاع هذا البيع؟",
    returnConfirmMessage: "سيتم إرجاع جميع المنتجات إلى المخزون واسترداد المبلغ من الصندوق. لا يمكن التراجع عن هذا الإجراء.",
    saleReturned: "تم إرجاع البيع بنجاح",
    returned: "مرتجع",
    cancelled: "ملغي",
    completed: "مكتمل",
    pending: "معلق",
    refund: "استرداد",
    noSalesIncome: "لا يوجد دخل مبيعات بعد",
    unitPrice: "سعر الوحدة",
    totalPrice: "السعر الإجمالي",
    paymentMethod: "طريقة الدفع",
    cash: "نقدي",
    partial: "جزئي",
    saleDetails: "تفاصيل البيع",
    itemsList: "المنتجات",
    returnProcessing: "جاري معالجة الإرجاع...",

    // Partners / Store Capital
    storeCapital: "رأس مال المتجر",
    partners: "الشركاء",
    partner: "شريك",
    addPartner: "إضافة شريك",
    editPartner: "تعديل شريك",
    partnerAdded: "تم إضافة الشريك بنجاح",
    partnerUpdated: "تم تحديث الشريك بنجاح",
    ownershipPercentage: "نسبة الملكية",
    ownershipWarning: "إجمالي نسبة الملكية لا يساوي 100%",
    totalInvested: "إجمالي الاستثمار",
    totalWithdrawn: "إجمالي المسحوب",
    profitDistributed: "الأرباح الموزعة",
    netBalance: "الرصيد الصافي",
    recordTransaction: "تسجيل معاملة",
    transactionRecorded: "تم تسجيل المعاملة بنجاح",
    selectPartner: "اختر شريك",
    investment: "استثمار",
    profitDistribution: "توزيع أرباح",
    partnerTransactions: "معاملات الشركاء",
    noPartnersYet: "لم يتم إضافة شركاء بعد",
    addPartnersToStart: "أضف شركاء عملك لبدء تتبع الاستثمارات والأرباح",
    noTransactionsYet: "لم يتم تسجيل معاملات بعد",
  },
} as const;

type TranslationKey = keyof typeof translations.en;

interface I18nContextType {
  t: (key: TranslationKey) => string;
  lang: Language;
  setLang: (lang: Language) => void;
  dir: "ltr" | "rtl";
}

const I18nContext = createContext<I18nContextType | undefined>(undefined);

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [lang, setLangState] = useState<Language>(() => {
    const saved = localStorage.getItem("md-cars-lang");
    return (saved === "ar" ? "ar" : "en") as Language;
  });

  const setLang = useCallback((newLang: Language) => {
    setLangState(newLang);
    localStorage.setItem("md-cars-lang", newLang);
  }, []);

  const dir = lang === "ar" ? "rtl" : "ltr";

  useEffect(() => {
    document.documentElement.setAttribute("dir", dir);
    document.documentElement.setAttribute("lang", lang);
    if (lang === "ar") {
      document.body.style.fontFamily = "'Noto Sans Arabic', 'Segoe UI', 'Tahoma', 'Arial', sans-serif";
    } else {
      document.body.style.fontFamily = "'Inter', 'Segoe UI', 'Tahoma', 'Arial', sans-serif";
    }
  }, [lang, dir]);

  const t = useCallback((key: TranslationKey): string => {
    return translations[lang][key] || translations.en[key] || key;
  }, [lang]);

  return (
    <I18nContext.Provider value={{ t, lang, setLang, dir }}>
      {children}
    </I18nContext.Provider>
  );
}

export function useI18n() {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error("useI18n must be used within an I18nProvider");
  }
  return context;
}
